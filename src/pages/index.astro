---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const menuItems = await getCollection('menu');
const wineItems = await getCollection('vins');

// Sort menu items by order
const sortedMenu = menuItems.sort((a, b) => a.data.order - b.data.order);

// Group menu items by category
const menuCategories = {
  'A Partager / Entrées': sortedMenu.filter(item => item.data.category === 'A Partager / Entrées'),
  'Plats': sortedMenu.filter(item => item.data.category === 'Plats'),
  'Douceurs': sortedMenu.filter(item => item.data.category === 'Douceurs'),
};

// Group wine items by type
const wineTypes = {
  'Rouges': wineItems.filter(item => item.data.type === 'Rouges'),
  'Blancs': wineItems.filter(item => item.data.type === 'Blancs'),
  'Rosés': wineItems.filter(item => item.data.type === 'Rosés'),
  'Bulles': wineItems.filter(item => item.data.type === 'Bulles'),
};
---

<Layout title="BARBARES | Restaurant & Bar à Vin">
	<!-- Hero Section -->
	<section class="min-h-screen flex flex-col justify-center items-center relative overflow-hidden border-b-4 border-deep-black">
		<div class="absolute inset-0 flex items-center justify-center opacity-10 pointer-events-none">
			<h1 class="text-[20vw] leading-none text-deep-black select-none">PUNK</h1>
		</div>

		<div class="z-10 text-center">
			<h1 class="text-[15vw] leading-[0.8] text-neon-red mix-blend-difference">BAR<br/>BARES</h1>
			<p class="text-2xl md:text-4xl font-courier mt-8 bg-deep-black text-paper inline-block px-4 py-2 transform -rotate-2">
				CUISINE BRUTE & VINS VIVANTS
			</p>
		</div>

		<div class="absolute bottom-0 w-full bg-neon-red text-deep-black py-2 border-t-4 border-deep-black marquee-container">
			<div class="marquee-content text-2xl font-anton uppercase">
				&nbsp;• Manger • Boire • Vivre • Pas de chichis • Juste du bon • Toulouse • Barbares • Cuisine Maison • Vins Nature •&nbsp;• Manger • Boire • Vivre • Pas de chichis • Juste du bon • Toulouse • Barbares • Cuisine Maison • Vins Nature •
			</div>
		</div>
	</section>

	<!-- Menu Section -->
	<section id="menu" class="py-24 px-4 md:px-12 border-b-4 border-deep-black bg-paper text-deep-black relative">
		<div class="max-w-6xl mx-auto">
			<h2 class="text-8xl md:text-9xl mb-24 text-stroke-black text-transparent relative inline-block">
				MANGER
				<span class="absolute -top-6 -right-6 text-2xl bg-neon-red text-deep-black px-2 py-1 transform rotate-12 border-2 border-deep-black">NOV 25</span>
			</h2>

			<div class="grid gap-24">
				{Object.entries(menuCategories).map(([category, items]) => (
					<div>
						<h3 class="text-5xl md:text-6xl mb-12 border-b-4 border-deep-black inline-block pb-2 hover:text-neon-red transition-colors cursor-default">{category}</h3>
						<div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-8">
							{items.map(item => (
								<div class="group relative border-2 border-transparent hover:border-deep-black p-4 transition-all duration-300 hover:bg-neon-red hover:text-paper hover:shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]">
									<div class="flex justify-between items-baseline mb-2 border-b-2 border-dotted border-deep-black/30 pb-1 group-hover:border-paper">
										<h4 class="text-2xl md:text-3xl">{item.data.title}</h4>
										{item.data.price && <span class="font-courier text-xl font-bold">{item.data.price}</span>}
									</div>
									<p class="font-courier text-lg opacity-80 group-hover:opacity-100">{item.data.description}</p>
								</div>
							))}
						</div>
					</div>
				))}
			</div>
		</div>
	</section>

	<!-- Wines Section -->
	<section id="vins" class="py-24 px-4 md:px-12 bg-deep-black text-paper relative overflow-hidden">
		<div class="absolute top-0 right-0 w-1/2 h-full bg-blood-red opacity-20 transform skew-x-12"></div>

		<div class="max-w-6xl mx-auto relative z-10">
			<h2 class="text-8xl md:text-9xl mb-24 text-neon-red text-right">
				BOIRE
			</h2>

			<div class="grid gap-24">
				{Object.entries(wineTypes).map(([type, items]) => (
					<div>
						<h3 class="text-5xl md:text-6xl mb-12 text-paper border-b-4 border-neon-red inline-block pb-2">{type}</h3>
						<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
							{items.map(item => (
								<div class="border-2 border-neon-red p-6 relative hover:bg-blood-red transition-colors group">
									{item.data.is_nature && (
										<span class="absolute -top-3 -right-3 bg-neon-red text-deep-black font-bold px-2 py-1 text-xs border-2 border-paper transform rotate-3">NATURE</span>
									)}
									<h4 class="text-2xl mb-2 group-hover:translate-x-2 transition-transform">{item.data.title}</h4>
									<div class="font-courier text-sm mb-4 opacity-70">
										<p>{item.data.domaine}</p>
										<p>{item.data.region}</p>
									</div>
									<div class="flex justify-between items-end border-t border-neon-red/30 pt-4 mt-auto">
										<div class="text-xs font-courier uppercase tracking-widest opacity-50">
											{item.data.note && <span>{item.data.note}</span>}
										</div>
										<div class="text-right font-bold font-courier">
											{item.data.price_glass && <div>Verre: {item.data.price_glass}</div>}
											{item.data.price_bottle && <div>Btl: {item.data.price_bottle}</div>}
										</div>
									</div>
								</div>
							))}
						</div>
					</div>
				))}
			</div>
		</div>
	</section>

	<!-- Call to Action -->
	<section class="py-24 bg-neon-red border-y-4 border-deep-black text-center">
		<h2 class="text-6xl md:text-8xl text-deep-black mb-8">FAIM ? SOIF ?</h2>
		<a href="https://www.instagram.com/barbares.toulouse" target="_blank" class="btn-punk bg-paper text-deep-black border-deep-black hover:bg-deep-black hover:text-neon-red text-4xl px-12 py-6">
			RÉSERVER MAINTENANT
		</a>
	</section>
</Layout>

<style>
	.text-stroke-black {
		-webkit-text-stroke: 2px #000;
	}
</style>
