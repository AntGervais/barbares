---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
import ChaoticLine from "../components/ChaoticLine.astro";
import DoodleArrow from "../components/DoodleArrow.astro";
import GlassCard from "../components/GlassCard.astro";

const menuItems = await getCollection("menu");
const wineItems = await getCollection("vins");

// Sort menu items by order
const sortedMenu = menuItems.sort((a, b) => a.data.order - b.data.order);

// Group menu items by category
const menuCategories = {
	"A Partager / Entrées": sortedMenu.filter(
		(item) => item.data.category === "A Partager / Entrées",
	),
	Plats: sortedMenu.filter((item) => item.data.category === "Plats"),
	Douceurs: sortedMenu.filter((item) => item.data.category === "Douceurs"),
};

// Group wine items by type
const wineTypes = {
	Rouges: wineItems.filter((item) => item.data.type === "Rouges"),
	Rosés: wineItems.filter((item) => item.data.type === "Rosés"),
	Blancs: wineItems.filter((item) => item.data.type === "Blancs"),
	Bulles: wineItems.filter((item) => item.data.type === "Bulles"),
};
---

<Layout title='BARBARES | Restaurant & Bar à Vin'>
	<!-- Hero Section -->
	<section
		class='min-h-screen flex flex-col justify-center items-center relative overflow-hidden border-b-4 border-deep-black bg-wood'>
		<!-- Background Gradient -->
		<div
			class='absolute inset-0 bg-gradient-to-b from-wood via-wood to-deep-black opacity-90'>
		</div>

		<!-- Chaotic Background Lines -->
		<div class='absolute inset-0 pointer-events-none opacity-20'>
			<ChaoticLine
				class='absolute top-[10%] left-0 w-full transform -rotate-2'
				color='stroke-paper'
			/>
			<ChaoticLine
				class='absolute top-[30%] left-0 w-full transform rotate-1'
				color='stroke-blood'
			/>
			<ChaoticLine
				class='absolute top-[60%] left-0 w-full transform -rotate-3'
				color='stroke-neon'
			/>
			<ChaoticLine
				class='absolute top-[80%] left-0 w-full transform rotate-2'
				color='stroke-paper'
			/>
		</div>

		<!-- Spinning Target Logo (Abstract) -->
		<div
			class='absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] border-[1px] border-paper/10 rounded-full animate-[spin_20s_linear_infinite] pointer-events-none'>
		</div>
		<div
			class='absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] border-[1px] border-blood/20 rounded-full animate-[spin_15s_linear_infinite_reverse] pointer-events-none'>
		</div>

		<div class='z-10 text-center relative px-4 flex flex-col items-center'>
			<span
				class='font-inter text-xl md:text-2xl tracking-[0.2em] text-paper/80 uppercase mb-6'
				>Bar à Vin</span
			>

			<h1
				class='text-[14vw] md:text-[10vw] leading-[0.8] text-paper font-altero mix-blend-screen relative -ml-[1vw]'>
				BARBARES
				<!-- Scribble over title -->
				<svg
					class='absolute top-0 left-0 w-full h-full pointer-events-none overflow-visible'
					viewBox='0 0 100 100'
					preserveAspectRatio='none'>
					<path
						d='M-10,50 Q50,40 110,60'
						fill='none'
						stroke='#ff0d0a'
						stroke-width='0.5'
						class='animate-shake opacity-50'></path>
				</svg>
			</h1>

			<span
				class='font-inter text-xl md:text-2xl tracking-[0.2em] text-paper/80 uppercase mt-4'
				>Comptoir Gourmand</span
			>

			<div class='mt-16 flex flex-col items-center gap-4'>
				<DoodleArrow
					direction='down'
					class='w-12 h-12 text-neon animate-bounce'
				/>
				<a
					href='#menu'
					class='font-scribble text-2xl text-neon hover:text-paper transition-colors transform -rotate-6 hover:rotate-0 duration-300'>
					Découvrir le carnage
				</a>
			</div>
		</div>
	</section>

	<!-- Menu Section -->
	<section
		id='menu'
		class='py-24 px-4 md:px-12 bg-paper text-deep-black relative'>
		<!-- Paper Texture Overlay -->
		<div
			class="absolute inset-0 opacity-50 pointer-events-none mix-blend-multiply bg-[url('https://www.transparenttextures.com/patterns/cream-paper.png')]">
		</div>

		<div class='max-w-5xl mx-auto relative z-10'>
			<div class='text-center mb-24 relative'>
				<h2
					class='text-8xl md:text-9xl font-altero text-deep-black relative inline-block'>
					LA CARTE
					<span
						class='absolute -top-6 -right-12 font-scribble text-4xl text-neon transform rotate-12'
						>Miam !</span
					>
				</h2>
				<ChaoticLine class='mt-4' color='stroke-deep-black' />
			</div>

			<div class='grid gap-24'>
				{
					Object.entries(menuCategories).map(
						([category, items]) =>
							items.length > 0 && (
								<div>
									<h3 class='text-4xl md:text-5xl font-altero mb-12 text-blood uppercase tracking-wide border-b-2 border-deep-black inline-block pb-2 transform -rotate-1'>
										{category}
									</h3>
									<div class='space-y-12'>
										{items.map((item, index) => (
											<div class='relative group'>
												<div class='flex justify-between items-baseline mb-2'>
													<h4 class='text-3xl md:text-4xl font-bold font-inter uppercase tracking-tight group-hover:text-blood transition-colors'>
														{item.data.title}
													</h4>
													<span class='font-inter text-2xl font-bold border-b-2 border-neon transform -rotate-2 px-2'>
														{item.data.price}
													</span>
												</div>
												<p class='font-inter text-xl text-deep-black/70'>
													{item.data.description}
												</p>

												{index % 3 === 0 && (
													<span class='absolute -right-12 top-0 font-scribble text-xl text-deep-black transform rotate-12 opacity-0 group-hover:opacity-100 transition-opacity duration-300'>
														Top !
													</span>
												)}
											</div>
										))}
									</div>
								</div>
							),
					)
				}
			</div>
		</div>
	</section>

	<!-- Wines Section -->
	<section
		id='vins'
		class='py-32 px-4 md:px-12 bg-deep-black text-paper relative overflow-hidden'>
		<!-- Cave Atmosphere -->
		<div
			class='absolute inset-0 bg-gradient-to-br from-deep-black via-[#1a0500] to-deep-black'>
		</div>

		<div class='max-w-7xl mx-auto relative z-10'>
			<section id='vins' class='py-20 bg-deep-black text-paper relative'>
				<div class='max-w-3xl mx-auto px-4 relative z-10'>
					<div class='text-center mb-16'>
						<h2 class='text-6xl md:text-8xl font-altero text-neon-red mb-4'>
							VINS
							<span
								class='block font-scribble text-4xl md:text-5xl text-neon-red mt-2 transform -rotate-6'>
								au verre
							</span>
						</h2>
						<DoodleArrow
							direction='down'
							class='w-12 h-12 text-neon-red mx-auto animate-pulse'
						/>
					</div>

					<div class='space-y-16'>
						{
							Object.entries(wineTypes).map(
								([type, items]) =>
									items.length > 0 && (
										<div>
											<div class='mb-8'>
												<h3 class='inline-block bg-[#d3d3d3] text-deep-black font-scribble text-3xl px-6 py-1 transform -rotate-2 shadow-lg uppercase tracking-widest'>
													{type}
												</h3>
											</div>
											<div class='space-y-8'>
												{items.map((item) => (
													<div class='group'>
														<div class='flex items-baseline justify-between mb-1'>
															<h4 class='text-xl md:text-2xl font-bold font-inter'>
																<span class='text-neon-red'>
																	{item.data.region}
																</span>{" "}
																• {item.data.domaine} "{item.data.title}"
															</h4>
															<div class='flex-grow mx-4 border-b-2 border-dotted border-paper/30 relative -top-1' />
															<div class='text-xl md:text-2xl font-bold font-inter'>
																{item.data.price_glass}
															</div>
														</div>

														<div class='text-lg font-inter text-paper/90 mb-1'>
															<Fragment
																set:html={item.body.replace(
																	/(Bio|Nature|BioDynaMie)/g,
																	'<span class="font-scribble text-neon-red text-xl mx-1">$1</span>',
																)}
															/>
														</div>

														<p class='font-scribble text-xl text-paper/60'>
															"{item.data.note}"
														</p>
													</div>
												))}
											</div>
										</div>
									),
							)
						}
					</div>
				</div>
			</section>

			<!-- Footer -->
			<section
				id='infos'
				class='py-20 bg-wood text-paper border-t-4 border-deep-black relative overflow-hidden'>
				<div class='max-w-4xl mx-auto text-center relative z-10 px-4'>
					<h2 class='text-5xl md:text-6xl font-altero mb-8 uppercase'>
						Vins fins pour<br />grandes gueules
					</h2>

					<div
						class='flex flex-col md:flex-row justify-center items-center gap-8 md:gap-16 mb-12 font-inter text-lg tracking-widest uppercase'>
						<p>Figeac, France</p>
						<p>Est. 2022</p>
						<a
							href='https://www.instagram.com/barbaresfigeac'
							target='_blank'
							class='hover:text-neon transition-colors'>Instagram</a
						>
					</div>

					<ChaoticLine color='stroke-neon' class='mb-12 opacity-50' />

					<p class='font-scribble text-2xl text-paper/40'>
						© {new Date().getFullYear()} BARBARES.
					</p>
				</div>
			</section>
		</div>
	</section></Layout
>
